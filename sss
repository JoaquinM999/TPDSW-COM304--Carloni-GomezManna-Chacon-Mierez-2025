# Prompt: Refactorizar URLs Hardcodeadas a Configuración Centralizada

## Contexto del Problema

La aplicación React/TypeScript tiene múltiples archivos con URLs hardcodeadas como `http://localhost:3000/api/...` que causan errores en producción (ERR_CONNECTION_REFUSED) porque intentan conectar a localhost en lugar de usar la API de producción configurada en las variables de entorno.

## Objetivo

Refactorizar todo el código para usar una configuración centralizada de la URL base de la API, permitiendo que funcione correctamente tanto en desarrollo (localhost) como en producción (URL del servidor remoto).

## Prompt para el Asistente

```
Necesito refactorizar mi proyecto React/TypeScript para eliminar todas las URLs hardcodeadas y usar una configuración centralizada. Aquí está lo que necesito:

1. **Verificar la configuración actual:**
   - Revisar el archivo `src/config/api.config.ts` para confirmar que existe la constante `API_BASE_URL`
   - Esta constante debe usar la variable de entorno `VITE_API_URL` en producción y `http://localhost:3000/api` en desarrollo

2. **Identificar todos los archivos con URLs hardcodeadas:**
   - Buscar recursivamente en `src/` todos los archivos `.ts` y `.tsx` que contengan `http://localhost:3000`
   - Excluir el archivo de configuración `api.config.ts` y archivos de utilidades que solo tengan URLs en comentarios

3. **Para cada archivo encontrado:**
   - Agregar el import: `import { API_BASE_URL } from '../config/api.config';` (ajustar la ruta relativa según corresponda)
   - Reemplazar todas las instancias de `'http://localhost:3000/api/'` por `${API_BASE_URL}/`
   - Reemplazar todas las instancias de `"http://localhost:3000/api/"` por `${API_BASE_URL}/`
   - Asegurar que no se rompan las template literals existentes

4. **Casos especiales:**
   - **authService.ts**: Crear un nuevo método `getCurrentUser()` que use `API_BASE_URL` para obtener el perfil del usuario actual
   - **PerfilPage.tsx**: Reemplazar el llamado directo a axios por el nuevo método `getCurrentUser()` del authService
   - **Archivos con múltiples URLs**: Reemplazar todas las instancias, una por una, cuidadosamente

5. **Validación:**
   - Después de cada cambio, verificar que no se hayan roto las comillas o las template literals
   - Asegurar que todos los imports sean correctos
   - Confirmar que no queden URLs hardcodeadas (excepto en comentarios o en api.config.ts)

6. **Crear un resumen:**
   - Listar todos los archivos modificados
   - Contar cuántas URLs fueron reemplazadas
   - Explicar los beneficios de la refactorización

## Patrón de Reemplazo

### Antes:
```typescript
const response = await fetch('http://localhost:3000/api/usuarios/me');
```

### Después:
```typescript
import { API_BASE_URL } from '../config/api.config';

const response = await fetch(`${API_BASE_URL}/usuarios/me`);
```

## Archivos Prioritarios

Enfócate especialmente en estos archivos que son críticos:
1. `src/paginas/PerfilPage.tsx`
2. `src/paginas/ConfiguracionUsuario.tsx`
3. `src/componentes/LoginModal.tsx`
4. `src/paginas/SiguiendoPage.tsx`
5. `src/paginas/FeedActividadPage.tsx`
6. Todos los archivos de autores (`AutoresPage.tsx`, `DetalleAutor.tsx`, etc.)
7. Todos los archivos de libros

## Metodología

1. Primero agregar el import de API_BASE_URL en cada archivo
2. Luego reemplazar las URLs una por una, verificando el contexto
3. Usar búsqueda con grep/search para encontrar todas las instancias
4. Trabajar archivo por archivo de forma sistemática
5. Al final, ejecutar una búsqueda final para confirmar que no quedan URLs hardcodeadas

## Resultado Esperado

- ✅ Cero URLs hardcodeadas en el código (excepto en api.config.ts)
- ✅ Todos los archivos usan API_BASE_URL importada desde config
- ✅ La aplicación funciona correctamente en desarrollo y producción
- ✅ El error ERR_CONNECTION_REFUSED en producción está resuelto
- ✅ Código más mantenible y escalable
```

## Comandos Útiles

### Buscar URLs hardcodeadas:
```powershell
Get-ChildItem -Path "src" -Recurse -Include *.tsx,*.ts | Select-String -Pattern "http://localhost:3000" | Select-Object -Unique Path
```

### Contar archivos con URLs hardcodeadas:
```powershell
Get-ChildItem -Path "src" -Recurse -Include *.tsx,*.ts | Select-String -Pattern "http://localhost:3000" | Select-Object -Unique Path | Measure-Object
```

### Reemplazo masivo (usar con precaución):
```powershell
$files = @('archivo1.tsx', 'archivo2.tsx')
foreach ($file in $files) {
  if (Test-Path $file) {
    (Get-Content $file -Raw) -replace 'http://localhost:3000/api/', '${API_BASE_URL}/' | Set-Content $file -NoNewline
  }
}
```

## Notas Importantes

- **No modificar** `src/config/api.config.ts` - este archivo debe mantener las URLs como valores por defecto
- **No modificar** URLs en comentarios JSDoc o ejemplos de documentación
- **Verificar** que las rutas relativas de import sean correctas para cada archivo
- **Probar** la aplicación después de los cambios en desarrollo y producción

## Variables de Entorno Requeridas

En **Vercel** (o tu plataforma de deployment), configurar:

```env
VITE_API_URL=https://tu-api-backend.onrender.com/api
```

En **desarrollo local**, crear `.env.local`:

```env
VITE_API_URL=http://localhost:3000/api
```

## Checklist de Validación

- [ ] Todos los archivos tienen el import de API_BASE_URL
- [ ] No hay URLs hardcodeadas (verificar con búsqueda)
- [ ] La aplicación compila sin errores
- [ ] Los endpoints de API funcionan en desarrollo
- [ ] La variable de entorno está configurada en producción
- [ ] El error ERR_CONNECTION_REFUSED está resuelto

---

**Fecha de creación:** Noviembre 14, 2025  
**Propósito:** Template para refactorización de URLs hardcodeadas a configuración centralizada  
**Aplicable a:** Proyectos React/TypeScript con Vite y backend API separado
